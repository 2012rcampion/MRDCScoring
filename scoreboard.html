<html>
	<head>
		<title>Scoreboard</title>
		<link rel='stylesheet' type='text/css' href='style.css'/>
		<script src='jquery-1.10.2.js'></script>
		<script src='/socket.io/socket.io.js'></script>
		<script>
			socket = io.connect(location.hostname);
			currentColor = -1;
			teamColors = [
				'#ff0000',
				'#ffff00',
				'#00ff00',
				'#0000ff',
				'#7f0000',
				'#7f7f00',
				'#007f00',
				'#00007f'
			];
			fieldColors = {
				't':'#ddc16f',
				'd':'#888888',
				'l':'#bbbbbb',
				'w':'#ffffff',
				'S':'#9370db',
			};
			size = 11;
			squareDim = 54; //pixels
				
			$(document).ready(function() {
				$('#field').css({width:size*squareDim, height:size*squareDim});
				for(var i = 0; i < size; i++) {
					var row = $('<tr></tr>');
					$('#board').append(row);
					for(var j = 0; j < size; j++) {
						var cell = $('<td></td>');
						cell.data('row', i);
						cell.data('col', j);
						cell.on('click', function() {
							var x = +$(this).data('col');
							var y = +$(this).data('row');
							socket.emit('scoreEvent', {
								type:'capture',
								team:currentColor,
								row:y,
								col:x
							});
						});
						cell.css({width:squareDim, height:squareDim})
						row.append(cell);
					}
				}
				
				var teamsDiv = $('#teams');
				for(var i = 0; i < 4; i++) {
					var listItem = $('<li></li>');
					listItem.html(
						'<span class=\'name\'>Team ' + (1+i) + '</span>' + 
						': <span class=\'score\'>0</span>'
					);
					listItem.data('team', i)
					listItem.css({'background-color': teamColors[i]});
					listItem.on('click', function() {
						currentColor = +$(this).data('team');
						$(this).siblings().removeClass('selected');
						$(this).addClass('selected');
					});
					teamsDiv.append(listItem);
				}
				
				var canvas = $('canvas#canvas')[0];
				canvas.width = size*squareDim;
				canvas.height = size*squareDim;
				context = canvas.getContext('2d');
				context.fillStyle = '#444444';
				context.fillRect(0, 0, size*squareDim, size*squareDim);
				
				socket.on('stateUpdate', function(data) {
					var f = data.field;
					console.log(data);
					context.clearRect(0, 0, size*squareDim, size*squareDim);
					context.lineWidth = 16;
					for(var i = 0; i < f.territories; i++) {
						var border = f.borders[i];
						context.beginPath();
						context.moveTo(border[0].x * squareDim,
							border[0].y * squareDim);
						for(var j = 1; j < border.length; j++ ) {
							context.lineTo(border[j].x * squareDim,
							border[j].y * squareDim);
						}
						context.closePath();
						
						context.fillStyle = fieldColors[f.colors[i]];
						context.fill();
						
						var color = f.state[i];
						if(color >= 0) {
							context.strokeStyle = teamColors[color];
							context.save();
							context.clip();
							context.stroke();
							context.restore();
						}
					}
					var teams = $('#teams').children();
					for(var i = 0; i < teams.length; i++) {
						$(teams[i]).find('.name').html(data.teams[i].name);
						$(teams[i]).find('.score').html(data.teams[i].score);
					}
				});
				
				//socket.emit('scoreEvent',{});
			
			});
		</script>
	</head>
	<body>
		<div id='field'>
			<table id='board'></table>
			<canvas id='canvas'></canvas>	
		</div>
		<ul id='teams'>
		</ul>
		<ul id='buttons'>
			<li>ACTION 1</li>
			<li>ACTION 2</li>
		</ul>
		<div style="border:1px dotted red;width:1022px;height:598px;position:fixed;left:0;top:0;z-index:-100;background-color:magenta">
	</body>
</html>