<html>
	<head>
		<title>Scoreboard</title>
		<link rel='stylesheet' type='text/css' href='style.css'/>
		<script src='jquery-1.11.0.js'></script>
		<script src='jquery-ui.js'></script>
		<script src='/socket.io/socket.io.js'></script>
		<script>
			socket = {};
			currentColor = -1;
			teamColors = [
				'#0000ff', //regular
				'#ffff00',
				'#00ff00',
				'#ff0000',
				'#00007f',
				'#7f7f00',
				'#007f00',
				'#7f0000'
			];
			fieldColors = {
				't':'#ddc16f',
				'd':'#888888',
				'l':'#bbbbbb',
				'w':'#ffffff',
				'S':'#9370db',
			};
			size = 11;
			squareDim = 50; //pixels
			
			var teamData = [];
				
			$(document).ready(function() {
				socket = io.connect(location.hostname);
				
				
				socket.on('updateState', function(data) {
					var f = data.field;
					//console.log(data);
					var list = $('#teams');
					list.find('li').remove();
					for(var i = 0; i < data.teams.length; i++) {
						var li = $('<button>')
							.text(data.teams[i].name + ':')
							.append($('<span>').text(
								data.scores[i].offsetScore +
								data.scores[i].baseScore *
								data.teams[i].multiplier
							))
							.data('team', i)
							.on('click', function() {
								currentColor = +$(this).data('team');
								$('#teams button').removeClass('selected');
								$(this).addClass('selected');
							});
						if(i == currentColor) {
							li.trigger('click');
						}
						list.append(
							$('<li>')
							.css('border-color', teamColors[i])
							.css('background-color', teamColors[i])
							.append(li)
						);
					}
				});
				
				socket.on('updateTime', function(data) {
					var m = Math.floor(data/60000);
					var s = Math.floor(data/1000)-60*m;
					$('.time').html(m+':'+('0'+s).slice(-2));
				});
				
				socket.on('updateTeams', function(data) {
					teamData = data;
					var list = $('#teamList');
					list.find('li').remove();
					var selector = $('.teamSelector');
					selector.find('option').remove();
					selector.append(
						$('<option>')
						.text('select team')
						.val('')
					);
					for(var i = 0; i < teamData.length; i++) {
						var t = teamData[i];
						teamData[t._id] = t;
						list.append(
							$('<li>')
							.text(t.name +
							(t.multiplier == 1 ? '' : ' (x'+t.multiplier+')'))
							.data('id', t._id)
							.on('click', function() {
								$('#teamSelector').val($(this).data('id'))
									.trigger('change');
							})
						);
						selector.append(
							$('<option>')
							.val(t._id)
							.text(t.name)
						);
					}
					selector.trigger('change');/*each(function(index, element) {
						element.trigger('change');
					});*/
				});
				
				socket.on('updateUpcoming', function(data) {
					var list = $('#upcomingList');
					list.find('li').remove();
					for(var i = 0; i < data.length; i++) {
						var u = data[i];
						var li = $('<li>').data('id', u._id);
						for(var j = 0; j < u.teams.length; j++) {
							li.append(
								$('<span>')
								.text(teamData[u.teams[j]].name)
								.addClass('upcoming')
								.append(
									$('<button>')
									.addClass('delete')
									.data('team', u.teams[j])
									.on('click', function() {
										socket.emit('removeUpcomingTeam', {
											_id:($(this).closest('li').data('id')),
											team:($(this).data('team'))
										});
									})
								)
							);
						}
						li.append(
							$('#teamSelector')
							.clone()
							.on('change', function() {
								if(!($(this).val())) {
									return;
								}
								socket.emit('addUpcomingTeam', {
									_id:($(this).parent('li').data('id')),
									team:($(this).val())
								});
							})
						);
						/*li.append(
							$('<button>')
							.text('Add')
							.data('id', u._id)
							.on('click', function() {
								socket.emit('addUpcomingTeam', {
									_id:($(this).parent('li').data('id')),
									team:($(this).prev('select').val())
								});
							})
						);*/
						list.append(li);
					}
				});
				
				socket.on('updateCompleted', function(data) {
					var list = $('#completedList');
					list.find('li').remove();
					for(var i = 0; i < data.length; i++) {
						var d = data[i];
						var li = $('<li>').data('id', d._id);
						for(var j = 0; j < d.teams.length; j++) {
							li.append(
								$('<span>').append(
									$('<span>').text(d.teams[j].name)
								)
								.append(': ')
								.append(
									$('<span>').text(
										d.scores[i].offsetScore +
										d.scores[i].baseScore *
										d.teams[i].multiplier
									)
								)
							)
						}
						li.append(
							$('<button>')
							.addClass('delete')
							.on('click', function() {
								socket.emit('removeCompleted',
									$(this).closest('li').data('id')
								);
							})
						);
						list.append(li);
					}
				});
			
			});
		</script>
	</head>
	<body>
		<div id='bottom'>
			<h2>Upcoming Matches</h2>
			<ul id='upcomingList'>
			</ul>
		</div>
		
		<div style="border:1px dotted red;width:1022px;height:567px;position:fixed;left:0;top:0;z-index:-100;background-color:#ffffff">
	</body>
</html>
